name: CI

on: [push]

jobs:
  unit_tests:
    name: Unit Tests
    runs-on: macOS-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v1
      with:
        fetch-depth: 1

    - name: Cache Ruby Gems
      uses: actions/cache@v1
      id: gems-cache
      with:
        path: vendor/bundle
        key: ${{ runner.os }}-gem-${{ hashFiles('**/Gemfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-gem-

    - name: Cache Cocoapods
      uses: actions/cache@v1
      id: cocoapods-cache
      with:
        path: Pods
        key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-pods-

    - name: Install Gem Dependencies
      if: steps.gems-cache.outputs.cache-hit != 'true'
      run: |
        bundle config path vendor/bundle
        bundle install
        
    - name: Install CocoaPods Dependencies
      if: steps.cocoapods-cache.outputs.cache-hit != 'true'
      run: pod install --repo-update

    - name: Run UnitTests
      run: bundle exec fastlane test

  snapshot_tests:
    name: Snapshot Tests
    runs-on: macOS-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v1
      with:
        fetch-depth: 1

    - name: Cache Ruby Gems
      uses: actions/cache@v1
      id: gems-cache
      with:
        path: vendor/bundle
        key: ${{ runner.os }}-gem-${{ hashFiles('**/Gemfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-gem-

    - name: Cache Cocoapods
      uses: actions/cache@v1
      id: cocoapods-cache
      with:
        path: Pods
        key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-pods-

    - name: Install Gem Dependencies
      if: steps.gems-cache.outputs.cache-hit != 'true'
      run: |
        bundle config path vendor/bundle
        bundle install
        
    - name: Install CocoaPods Dependencies
      if: steps.cocoapods-cache.outputs.cache-hit != 'true'
      run: pod install --repo-update

    - name: Run SnapshotTests
      run: bundle exec fastlane snapshot_test

  swiftlint:
    name: Swiftlint
    runs-on: macOS-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v1
      with:
        fetch-depth: 1

    - name: Cache Ruby Gems
      uses: actions/cache@v1
      id: gems-cache
      with:
        path: vendor/bundle
        key: ${{ runner.os }}-gem-${{ hashFiles('**/Gemfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-gem-

    - name: Cache Cocoapods
      uses: actions/cache@v1
      id: cocoapods-cache
      with:
        path: Pods
        key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-pods-

    - name: Install Gem Dependencies
      if: steps.gems-cache.outputs.cache-hit != 'true'
      run: |
        bundle config path vendor/bundle
        bundle install
        
    - name: Install CocoaPods Dependencies
      if: steps.cocoapods-cache.outputs.cache-hit != 'true'
      run: pod install --repo-update

    - name: Run Swiftlint
      run: Pods/SwiftLint/swiftlint lint --config .swiftlint.yml
